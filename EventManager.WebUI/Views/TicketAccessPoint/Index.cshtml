@model object
@{
    Layout = "/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Ticket Types Management";
}
<div class="container-fluid">
    <div class="card ">
        <div class="card-body p-4 p-lg-5">
            <!-- Header Section -->
            <div class="row mb-5">
                <div class="col-12">
                    <div class="d-flex align-items-center mb-4">
                        <div class="bg-warning bg-gradient rounded-3 p-3 me-4 shadow-sm">
                            <i class="fas fa-tags fa-2x text-white"></i>
                        </div>
                        <div>
                            <h1 class="h2 fw-bold text-dark mb-2">Ticket Types Management</h1>
                            <p class="text-muted mb-0 fs-5">Manage your ticket types, pricing, capacity, and access permissions</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ticket Types Section -->
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
                        <!-- Card Header -->
                        <div class="card-header bg-gradient bg-white border-0 py-4 px-4">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-0 fw-bold text-dark">
                                        <i class="fas fa-layer-group text-warning me-2"></i>
                                        Available Ticket Types
                                    </h5>
                                    <p class="text-muted mb-0 mt-1">Manage and configure all ticket types</p>
                                </div>
                            </div>
                        </div>

                        <!-- Card Body -->
                        <div class="card-body p-4 p-md-5">
                            <!-- Loading State -->
                            <div id="loadingTicketTypes" class="text-center py-5">
                                <div class="spinner-border text-warning" role="status" style="width: 3rem; height: 3rem;">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="text-muted mt-4 fw-semibold fs-5">Fetching ticket types...</p>
                            </div>

                            <!-- Ticket Types Grid -->
                            <div id="ticketTypesContainer" class="row g-4" style="display: none;">
                                <!-- Ticket type cards will be dynamically added here -->
                            </div>

                            <!-- Empty State -->
                            <div id="emptyTicketTypes" class="text-center py-5" style="display: none;">
                                <div class="py-5">
                                    <i class="fas fa-ticket-alt fa-4x text-light mb-4" style="color: #f0f0f0 !important;"></i>
                                    <h4 class="text-muted fw-bold mb-3">No Ticket Types Found</h4>
                                    <p class="text-muted mb-4">Start by creating your first ticket type</p>
                                    <button class="btn btn-warning fw-semibold px-4">
                                        <i class="fas fa-plus me-2"></i>Create Ticket Type
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i id="toastIcon" class="me-2"></i>
            <strong class="me-auto" id="toastHeaderTitle">Notification</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastMessage"></div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {

            // --- UI FUNCTIONS ---

            function showToast(message, type = 'info') {
                const toastElement = document.getElementById('liveToast');
                const toastBody = document.getElementById('toastMessage');
                const toastHeader = toastElement.querySelector('.toast-header');
                const toastIcon = document.getElementById('toastIcon');
                const toastHeaderTitle = document.getElementById('toastHeaderTitle');

                // Reset classes and content
                toastHeader.className = 'toast-header';
                toastIcon.className = '';

                let iconClass = 'fas fa-info-circle';
                let headerTitle = 'Notification';

                switch(type) {
                    case 'success':
                        toastHeader.classList.add('text-bg-success');
                        iconClass = 'fas fa-check-circle';
                        headerTitle = 'Success';
                        break;
                    case 'error':
                        toastHeader.classList.add('text-bg-danger');
                        iconClass = 'fas fa-times-circle';
                        headerTitle = 'Error';
                        break;
                    case 'warning':
                        // Use warning theme for consistency, but keep dark text
                        toastHeader.classList.add('text-bg-warning', 'text-dark');
                        iconClass = 'fas fa-exclamation-triangle';
                        headerTitle = 'Warning';
                        break;
                    default: // info
                        toastHeader.classList.add('text-bg-info');
                        iconClass = 'fas fa-info-circle';
                        headerTitle = 'Information';
                }

                toastIcon.classList.add(iconClass);
                toastHeaderTitle.textContent = headerTitle;
                toastBody.textContent = message;

                const toast = new bootstrap.Toast(toastElement);
                toast.show();
            }

            // --- DATA LOAD/RENDER ---

            function loadTicketTypes() {
                $.ajax({
                    url: '/TicketAccessPoint/GetTicketTypes',
                    type: 'GET',
                    beforeSend: function() {
                        $('#loadingTicketTypes').show();
                        $('#ticketTypesContainer').hide().empty();
                        $('#emptyTicketTypes').hide();
                    },
                    success: function(data) {
                        if (data && data.length > 0) {
                            // Sort ticket types by name (A-Z)
                            data.sort((a, b) => {
                                const nameA = a.ticketName?.toUpperCase() || '';
                                const nameB = b.ticketName?.toUpperCase() || '';
                                return nameA.localeCompare(nameB);
                            });

                            renderTicketTypes(data);
                            $('#ticketTypesContainer').show();
                        } else {
                            $('#emptyTicketTypes').show();
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error loading ticket types:', error);
                        showToast('Failed to load ticket types. Please try again.', 'error');
                        $('#emptyTicketTypes').show();
                    },
                    complete: function() {
                        $('#loadingTicketTypes').hide();
                    }
                });
            }

            // Render ticket types (Orange-themed Design)
            function renderTicketTypes(ticketTypes) {
                const container = $('#ticketTypesContainer');

                ticketTypes.forEach(function(ticket) {
                    const isFree = ticket.price === 0;

                    // Pricing Badge: Free is Green, Paid uses the Warning/Orange theme
                    const priceBadge = `
                        <span class="badge ${isFree ? 'bg-success-subtle text-success' : 'bg-warning-subtle text-warning'} px-3 py-2 fw-bold rounded-pill shadow-sm">
                            ${isFree ? 'FREE' : '$' + (ticket.price ? ticket.price.toFixed(2) : '0.00')}
                        </span>`;

                    // Capacity
                    const capacityContent = ticket.maxCapacity
                        ? `<span class="text-secondary small fw-medium"><i class="fas fa-users me-1"></i>Capacity: ${ticket.maxCapacity}</span>`
                        : `<span class="text-secondary small fw-medium"><i class="fas fa-infinity me-1"></i>Unlimited Capacity</span>`;

                    // Card structure
                    const card = `
                        <div class="col-sm-6 col-md-4 col-lg-3">
                            <div class="card h-100 shadow-hover border-warning-subtle rounded-3">
                                <div class="card-body d-flex flex-column p-4">

                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        ${priceBadge}
                                    </div>

                                    <h5 class="card-title mb-2 fw-bolder text-dark">${ticket.ticketName}</h5>

                                    <div class="mb-3">
                                        ${capacityContent}
                                    </div>

                                    <p class="card-text small text-secondary mb-4 flex-grow-1">
                                        ${ticket.description ? ticket.description.substring(0, 100) + (ticket.description.length > 100 ? '...' : '') : 'No description provided.'}
                                    </p>

                                    <div class="d-flex gap-2 mt-auto">
                                        <a href="/TicketAccessPoint/Manage/${ticket.ticketTypeId}"
                                           class="btn btn-sm btn-warning text-dark w-100 fw-bold shadow-sm">
                                            <i class="fas fa-user-shield me-2"></i>Access Points
                                        </a>
                                        <a href="/TicketParticipants/Index/${ticket.ticketTypeId}"
                                           class="btn btn-sm btn-outline-warning text-dark w-100 fw-bold shadow-sm">
                                            <i class="fas fa-users me-2"></i>Participants
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    container.append(card);
                });
            }

            // Initialize
            loadTicketTypes();
        });
    </script>

    <style>
        .shadow-hover {
            transition: box-shadow 0.3s ease-in-out, transform 0.2s ease-in-out;
        }

            .shadow-hover:hover {
                /* Deeper shadow on hover */
                box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
                /* Slight lift effect, and use the warning color border */
                transform: translateY(-2px);
                border-color: #ffc107 !important; /* Warning color border on hover */
            }

        .text-secondary-emphasis {
            color: #5c636a; /* Secondary dark color */
        }

        .lead-sm {
            font-size: 1rem;
        }

        /* Button hover effects */
        .btn-outline-warning:hover {
            background-color: #ffc107;
            color: #212529 !important;
            border-color: #ffc107;
        }

        /* Adjust button sizing for two buttons */
        .card-body .d-flex.gap-2 {
            gap: 0.5rem !important;
        }
    </style>
}