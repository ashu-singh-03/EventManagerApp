@model IEnumerable<EventManager.Application.DTOs.EventDto>

@{
    Layout = "/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Access Point";
}

<style>
 
    /* --- General Layout & Header --- */
    .dashboard-header {
        border-bottom: 1px solid #dee2e6;
        padding-bottom: 1.5rem;
        margin-bottom: 3rem !important;
    }

    /* --- Premium Event Card (The "Ticket" Look) --- */
    .premium-card {
        border: none;
        border-radius: 1.5rem;
        overflow: hidden;
        transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.3s ease-in-out;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); /* Deeper default shadow */
        background-color: #ffffff;
    }

        .premium-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 45px rgba(0, 0, 0, 0.2);
        }

    /* --- Status/Metric Badge --- */
    .status-badge {
        font-size: 0.75rem;
        font-weight: 700;
        padding: 0.3rem 0.6rem;
        border-radius: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* --- Key Date Block (Stacked Day/Date) --- */
    .date-block {
        background-color: var(--primary-yellow);
        color: var(--text-dark);
        border-radius: 0.75rem;
        width: 70px; /* Fixed width for uniformity */
        height: 70px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 5px;
        flex-shrink: 0;
    }

        .date-block .day {
            font-size: 0.8rem;
            font-weight: 600;
            line-height: 1;
        }

        .date-block .date {
            font-size: 1.5rem;
            font-weight: 800;
            line-height: 1;
        }

    /* --- Event Info Block --- */
    .event-info-block {
        padding-top: 1rem;
        margin-top: 0.5rem;
        border-top: 1px dashed #e9ecef;
    }

        .event-info-block i {
            color: var(--primary-yellow);
            font-size: 1rem;
        }

    /* --- Best Practices/Tip Cards --- */
    .tip-card-icon-modern {
        color: var(--primary-yellow);
        background-color: rgba(255, 193, 7, 0.15);
        padding: 1rem;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 64px;
        height: 64px;
        margin-bottom: 1rem;
    }

        .tip-card-icon-modern i {
            font-size: 2.2rem !important;
        }

    .best-practices-section .premium-card {
        box-shadow: none; /* Make them look lighter and informational */
        background-color: var(--card-bg-light);
    }

        .best-practices-section .premium-card:hover {
            transform: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
</style>

<div class="container py-5">

    <div class="dashboard-header d-flex justify-content-between align-items-center mb-5">
        <h1 class="fw-bolder display-6 text-dark mb-0">Event Management Hub</h1>
        <a class="btn btn-warning btn-lg fw-bold px-4 py-3 shadow-lg" asp-controller="Event" asp-action="Create">
            <i class="fa-solid fa-calendar-plus me-2"></i> Create New Event
        </a>
    </div>

    @if (!Model.Any())
    {
    }
    else
    {
        <div id="eventContainer" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-5">
            @foreach (var evt in Model)
            {
                <div class="col" id="eventCard_@evt.EventId">
                    <div class="card premium-card h-100">
                        <div class="card-body d-flex flex-column">

                            <div class="d-flex justify-content-between align-items-start mb-3">
                                @{
                                    // Parse EventDate string to DateTime
                                    DateTime eventDate = DateTime.Parse(evt.EventDate);
                                    bool isLive = eventDate >= DateTime.Now.Date;
                                    var badgeClass = isLive ? "bg-success text-white" : "bg-secondary text-white";
                                    var badgeText = isLive ? "LIVE" : "DRAFT/PAST";
                                }
                            <span class="badge @badgeClass status-badge">@badgeText</span>

                            <div class="text-end">
                                <h6 class="mb-0 text-muted small">Participants</h6>
                                <h4 class="fw-bolder text-info mb-0">125+</h4>
                            </div>
                        </div>

                        <div class="d-flex align-items-center mb-3">
                            <div class="date-block me-3">
                                <span class="day">@eventDate.ToString("MMM")</span>
                                <span class="date">@eventDate.ToString("dd")</span>
                            </div>

                            <div class="flex-grow-1">
                                <h5 class="card-title fw-bolder text-dark mb-1">@evt.EventName</h5>
                                <p class="text-secondary small mb-0 overflow-hidden" style="max-height: 1.5rem; line-height: 1.5;">
                                    @((evt.EventDescription != null && evt.EventDescription.Length > 40)
                                                                    ? evt.EventDescription.Substring(0, 40) + "..."
                                                                    : evt.EventDescription)
                                    </p>
                                </div>
                            </div>

                            <div class="mb-4 event-info-block">
                                @* Event Time *@
                                <p class="text-muted mb-1 small d-flex align-items-center">
                                    @{
                                        string eventTimeDisplay = "Time TBD";
                                        if (!string.IsNullOrEmpty(evt.EventTime))
                                        {
                                            TimeSpan ts = TimeSpan.Parse(evt.EventTime);
                                            eventTimeDisplay = DateTime.Today.Add(ts).ToString("h:mm tt");
                                        }
                                    }
                                    <i class="fa-solid fa-clock me-2"></i>
                                    <span class="text-dark fw-semibold">@eventTimeDisplay</span>
                                </p>

                                @* Event Location *@
                                <p class="text-muted mb-0 small d-flex align-items-center">
                                    <i class="fa-solid fa-location-dot me-2"></i>
                                    <span class="text-dark fw-semibold">@evt.Location</span>
                                </p>
                            </div>

                            <div class="mt-auto d-grid gap-2">
                                <form method="post" asp-controller="Event" asp-action="SetEventAndManage">
                                    <input type="hidden" name="eventId" value="@evt.EventId" />
                                    <button type="submit" class="btn btn-info">Manage Event</button>
                                </form>


                                <div class="btn-group" role="group">
                                    <form method="post" asp-controller="Event" asp-action="Edit">
                                        <input type="hidden" name="eventId" value="@evt.EventId" />
                                        <button type="submit" class="btn btn-outline-secondary btn-sm">
                                            <i class="fa-solid fa-pen me-1"></i> Edit Details
                                        </button>
                                    </form>

                                    <button class="btn btn-outline-danger btn-sm delete-event" data-id="@evt.EventId">
                                        <i class="fa-solid fa-trash me-1"></i> Delete Event
                                    </button>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            }
        </div>
    }

    <hr class="my-6" style="margin-top: 5rem !important; margin-bottom: 5rem !important;">
    <h2 class="fw-bolder text-dark mb-5 text-center">Event Management Best Practices</h2>
    <div class="row row-cols-1 row-cols-md-3 g-4 best-practices-section">
        <div class="col">
            <div class="card premium-card p-4 h-100 text-center bg-light border-0">
                <div class="mx-auto tip-card-icon-modern">
                    <i class="fa-solid fa-bullhorn fa-2x"></i>
                </div>
                <h5 class="fw-bold text-dark">Maximize Reach</h5>
                <p class="text-secondary small mb-0">Utilize social sharing features to significantly boost your event's visibility and attendance.</p>
            </div>
        </div>
        <div class="col">
            <div class="card premium-card p-4 h-100 text-center bg-light border-0">
                <div class="mx-auto tip-card-icon-modern">
                    <i class="fa-solid fa-clipboard-check fa-2x"></i>
                </div>
                <h5 class="fw-bold text-dark">Check-in Efficiency</h5>
                <p class="text-secondary small mb-0">Prepare a smooth registration and check-in process to enhance the participant experience.</p>
            </div>
        </div>
        <div class="col">
            <div class="card premium-card p-4 h-100 text-center bg-light border-0">
                <div class="mx-auto tip-card-icon-modern">
                    <i class="fa-solid fa-layer-group fa-2x"></i>
                </div>
                <h5 class="fw-bold text-dark">Post-Event Analysis</h5>
                <p class="text-secondary small mb-0">Review your event data to understand attendee behavior and plan improvements for future events.</p>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        $(document).ready(function () {
            // Handle Delete button (AJAX functionality)
            $('#eventContainer').on('click', '.delete-event', function () {
                var eventId = $(this).data('id');

                if (confirm('Are you sure you want to delete this event? This action cannot be undone.')) {
                    $.ajax({
                        url: '@Url.Action("Delete", "Event")',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(eventId),
                        success: function (response) {
                            if (response.success) {
                                // Use a toast or temporary message instead of alert for better UI
                                // alert(response.message);
                                $('#eventCard_' + eventId).fadeOut(600, function () {
                                    $(this).remove();
                                    // Reload if the last card is gone to show the Welcome view
                                    if ($('#eventContainer').children().length === 0) {
                                        location.reload();
                                    }
                                });
                            } else {
                                alert(response.message || 'Failed to delete event.');
                            }
                        },
                        error: function (xhr) {
                            console.error(xhr);
                            alert('Error deleting event: The server could not complete the request.');
                        }
                    });
                }
            });
        });
    </script>
}