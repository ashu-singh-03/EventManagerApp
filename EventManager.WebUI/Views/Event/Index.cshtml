@model IEnumerable<EventManager.Application.DTOs.EventDto>

@{
    Layout = "/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Event Hub";
}

<style>
    /* Container & Background */
    .event-container {
        background-color: #f4f7f6;
        min-height: 100vh;
        padding-bottom: 50px;
    }

    /* Event Card */
    .event-card {
        border: none;
        border-radius: 16px;
        background: #fff;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        height: 100%;
    }

        .event-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.12);
        }

    /* Date Badge */
    .date-box {
        width: 60px;
        background: #fff;
        border-radius: 10px;
        text-align: center;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .date-box-month {
        background: #FFC107;
        color: #000;
        font-size: 0.75rem;
        font-weight: 800;
        padding: 3px 0;
        text-transform: uppercase;
    }

    .date-box-day {
        font-size: 1.4rem;
        font-weight: 800;
        color: #212529;
        line-height: 1.2;
        padding: 4px 0;
    }

    /* Participant Pill */
    .participant-pill {
        background: linear-gradient(90deg, rgba(255,193,7,0.15), rgba(255,193,7,0.05));
        color: #856404;
        font-weight: 700;
        border-radius: 50px;
        font-size: 0.75rem;
        padding: 5px 12px;
    }

    /* Card Body */
    .card-body-custom {
        padding: 20px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .event-title {
        font-size: 1.3rem;
        font-weight: 800;
        color: #212529;
        margin-bottom: 15px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        height: 3em;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        padding-top: 15px;
        border-top: 1px solid #f0f0f0;
        margin-bottom: 15px;
    }

    .info-item {
        flex: 1;
    }

    .event-card {
        border: 1px solid #e0e0e0; /* Light gray border */
        border-radius: 16px;
        background: #fff;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        height: 100%;
    }

        .event-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.12);
            border-color: #FFC107; /* Yellow border on hover */
        }

    .info-label {
        font-size: 0.65rem;
        color: #999;
        text-transform: uppercase;
        font-weight: 700;
        display: block;
        margin-bottom: 2px;
    }

    .info-value {
        font-size: 0.85rem;
        font-weight: 600;
        color: #444;
    }

    .text-yellow {
        color: #FFC107 !important;
    }

    /* Buttons */
    .btn-action {
        border-radius: 12px;
        font-weight: 700;
        font-size: 0.8rem;
        padding: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: all 0.2s ease-in-out;
    }

        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }

    .btn-manage {
        background-color: #212529;
        color: #fff;
        border: none;
    }

        .btn-manage:hover {
            background-color: #000;
            color: #FFC107;
        }

    .btn-edit-lite {
        border: 1.5px solid #212529;
        color: #212529;
        background: transparent;
    }

        .btn-edit-lite:hover {
            background: #f8f9fa;
        }

    .btn-delete-lite {
        border: 1.5px solid #dc3545;
        color: #dc3545;
        background: transparent;
    }

        .btn-delete-lite:hover {
            background: #dc3545;
            color: #fff;
        }

</style>

<div class="event-container py-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-5">
            <div>
                <h1 class="fw-bold text-dark">Event Dashboard</h1>
                <p class="text-muted">Manage your upcoming schedules and participants</p>
            </div>
            <a class="btn btn-warning px-4 py-2 fw-bold shadow-sm" style="background:#FFC107; border:none; border-radius:10px;" asp-controller="Event" asp-action="Create">
                <i class="fa-solid fa-plus me-2"></i>CREATE EVENT
            </a>
        </div>

        <!-- Responsive Grid for Cards -->
        <div class="row g-4">
            @foreach (var evt in Model)
            {
                <div class="col-12 col-md-6 col-lg-4" id="row_@evt.EventId">
                    <div class="card event-card h-100">
                        <div class="card-body-custom">
                            <div class="d-flex justify-content-between align-items-start mb-4">
                                <div class="date-box">
                                    <div class="date-box-month">@DateTime.Parse(evt.EventDate).ToString("MMM")</div>
                                    <div class="date-box-day">@DateTime.Parse(evt.EventDate).ToString("dd")</div>
                                </div>
                                <span class="participant-pill">
                                    <i class="fa-solid fa-users me-1"></i> @(evt.ParticipantCount > 0 ? evt.ParticipantCount : 0)
                                </span>
                            </div>

                            <h5 class="event-title">@evt.EventName</h5>

                            <div class="info-row">
                                <div class="info-item">
                                    <span class="info-label">Timing</span>
                                    <span class="info-value">
                                        <i class="fa-regular fa-clock text-yellow me-1"></i>
                                        @{
                                            TimeSpan ts;
                                            string time = TimeSpan.TryParse(evt.EventTime, out ts)
                                            ? DateTime.Today.Add(ts).ToString("h:mm tt") : "TBD";
                                        }
                                        @time
                                    </span>
                                </div>
                                <div class="info-item border-start ps-3">
                                    <span class="info-label">Location</span>
                                    <span class="info-value text-truncate d-block" style="max-width: 120px;">
                                        <i class="fa-solid fa-location-dot text-yellow me-1"></i> @evt.Location
                                    </span>
                                </div>
                            </div>

                            <div class="action-footer">
                                <form method="post" asp-controller="Event" asp-action="SetEventAndManage" class="mb-2">
                                    <input type="hidden" name="eventId" value="@evt.EventId" />
                                    <button type="submit" class="btn btn-action btn-manage w-100">
                                        <i class="fa-solid fa-sliders"></i> MANAGE EVENT
                                    </button>
                                </form>

                                <div class="d-flex gap-2">
                                    <form method="post" asp-controller="Event" asp-action="Edit" class="flex-grow-1 mb-0">
                                        <input type="hidden" name="eventId" value="@evt.EventId" />
                                        <button type="submit" class="btn btn-action btn-edit-lite w-100">
                                            <i class="fa-solid fa-pen"></i> EDIT
                                        </button>
                                    </form>
                                    <button class="btn btn-action btn-delete-lite flex-grow-1 delete-event" data-id="@evt.EventId">
                                        <i class="fa-solid fa-trash"></i> DELETE
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>


@section Scripts {
    <script>
        $(document).ready(function () {

            // AJAX Delete
            $('.delete-event').click(function () {
                var id = $(this).data('id');
                if (confirm('Delete this event?')) {
                    $.ajax({
                        url: '@Url.Action("Delete", "Event")',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(id),
                        success: function (res) {
                            if (res.success) {
                                $('#row_' + id).fadeOut(300, function() { $(this).remove(); });
                            }
                        }
                    });
                }
            });
        });
    </script>
}